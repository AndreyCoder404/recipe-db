# recipe-db

REST API для управления рецептами в рамках проекта HealthyLifeBot — Telegram-бота для здорового образа жизни.

## Что это за проект?

### Описание миссии и назначения recipe-db

`recipe-db` — это REST API, разработанный для управления рецептами, включая их создание, чтение, обновление и удаление (в будущем). Проект является частью экосистемы HealthyLifeBot — Telegram-бота, который помогает пользователям вести здоровый образ жизни, предлагая рецепты, тренировки и подкасты. Основная задача `recipe-db` — предоставить бэкенду HealthyLifeBot доступ к базе данных рецептов через API, чтобы бот мог рекомендовать блюда с учётом макронутриентов (белки, жиры, углеводы) и калорийности.

#### Основные цели:
- **Хранение рецептов**: Сохранение данных о рецептах (название, макронутриенты, калории, инструкции).
- **Предоставление API**: Обеспечение удобного интерфейса для взаимодействия с базой рецептов через HTTP-запросы.
- **Интеграция с HealthyLifeBot**: API будет использоваться ботом для рекомендаций пользователям.
- **Масштабируемость**: Проект должен быть готов к добавлению новых функций (например, фильтрация, пагинация).

#### Текущая функциональность:
На данный момент реализован базовый функционал:
- Эндпоинт `GET /recipes` возвращает список всех рецептов в формате JSON.
- Поддержка PostgreSQL для хранения данных.
- Юнит- и интеграционные тесты для проверки функциональности.

#### Роль в HealthyLifeBot:
`recipe-db` — это бэкенд-компонент, который отвечает за управление рецептами. HealthyLifeBot будет отправлять запросы к этому API, чтобы получать данные о рецептах и передавать их пользователям через Telegram-интерфейс.

---

## Как установить и запустить?

### Зависимости
Для работы проекта необходимы следующие инструменты:
- **Go**: Версия 1.22 или выше. Используется для разработки и запуска сервера.
  - Установите Go: [https://go.dev/doc/install](https://go.dev/doc/install).
  - Проверьте версию: `go version`.
- **Docker и Docker Compose**: Для запуска PostgreSQL.
  - Установите Docker: [https://docs.docker.com/get-docker/](https://docs.docker.com/get-docker/).
  - Установите Docker Compose: [https://docs.docker.com/compose/install/](https://docs.docker.com/compose/install/).
  - Проверьте: `docker --version` и `docker-compose --version`.
- **Git**: Для клонирования репозитория.
  - Установите Git: [https://git-scm.com/downloads](https://git-scm.com/downloads).

### Шаги по установке и запуску

1. **Клонируйте репозиторий**:
   ```bash
   git clone https://github.com/AndreyCoder404/recipe-db.git
   cd recipe-db


2. Установите зависимости Go: Убедитесь, что все зависимости установлены:

go mod tidy
Основные зависимости, указанные в go.mod:
github.com/gorilla/mux — для маршрутизации HTTP-запросов.
github.com/lib/pq — драйвер PostgreSQL.
github.com/DATA-DOG/go-sqlmock — для юнит-тестов.
github.com/sirupsen/logrus — для логирования.
Настройте PostgreSQL:
Проект использует PostgreSQL, запущенный через Docker Compose.
Файл docker-compose.yml уже настроен:
yaml


version: '3.8'
services:
  db:
    image: postgres:15
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: recipe_db
    ports:
      - "5432:5432"
    volumes:
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql


Запустите контейнер:

docker-compose up -d

Проверьте, что контейнер работает:

docker ps


API-спецификация
На данный момент доступен один эндпоинт.

GET /recipes
Описание: Возвращает список всех рецептов в базе данных.
Метод: GET
Путь: /recipes
Параметры: Отсутствуют.
Заголовки:
Accept: application/json (рекомендуется).
Формат ответа: JSON.
Статус-коды:
200 OK: Успешный запрос.
500 Internal Server Error: Ошибка на стороне сервера (например, проблемы с базой данных).


Пример запроса
curl http://localhost:8080/recipes


Пример ответа
[
    {
        "id": 1,
        "name": "Test Recipe",
        "protein": 10,
        "fat": 5,
        "carbs": 20,
        "calories": 200,
        "instructions": "Cook for 10 minutes"
    }
]



## Использование через Postman:
1. Откройте Postman.
2. Создайте новый запрос:
--Метод: GET.
--URL: http://localhost:8080/recipes.
--Заголовки: Accept: application/json.
3. Нажмите "Send".
. Проверьте ответ (должен быть таким же, как в примере выше).


## Структура ответа:
Каждый объект Recipe содержит следующие поля:

id (int): Уникальный идентификатор рецепта.
name (string): Название рецепта.
protein (float): Количество белков (в граммах).
fat (float): Количество жиров (в граммах).
carbs (float): Количество углеводов (в граммах).
calories (int): Калорийность (в ккал).
instructions (string): Инструкции по приготовлению.


### Как внести изменения?

## Структура проекта

recipe-db/
├── db/
│   └── db.go              # Подключение к PostgreSQL
├── docker-compose.yml     # Конфигурация Docker
├── go.mod                 # Зависимости Go
├── go.sum                 # Контрольный файл зависимостей
├── handlers/
│   ├── handlers.go        # Обработчики эндпоинтов
│   └── handlers_test.go   # Тесты
├── init.sql               # Миграция для базы данных
├── main.go                # Основной файл приложения
├── models/                # Пустая папка (для будущих моделей)
└── .github/workflows/
    └── ci.yml             # CI/CD через GitHub Actions

## Работа с Git

1. Создайте новую ветку:

git checkout -b feature/new-feature

Пример: feature/add-post-endpoint.

2. Внесите изменения:

-- Отредактируйте файлы (например, добавьте новый эндпоинт в handlers/handlers.go).

--Протестируйте локально:

go test ./handlers -v
go run main.go


3. Закоммитьте изменения:

git add .
git commit -m "Добавлен эндпоинт POST /recipes"

4. Отправьте изменения:

git push origin feature/new-feature


5. Создайте Pull Request:
-- Перейдите на https://github.com/AndreyCoder404/recipe-db/pulls.
-- Создайте PR из ветки feature/new-feature в main.
-- Опишите изменения и укажите, какие тесты добавлены.

## CI/CD
1. Проект использует GitHub Actions для автоматизации:
-- Файл .github/workflows/ci.yml запускает тесты при каждом пушу и PR.
-- Тесты выполняются с PostgreSQL (сервис настроен в ci.yml).

2. Проверьте статус CI/CD:
https://github.com/AndreyCoder404/recipe-db/actions


### Какие есть ограничения?

## Текущие недочёты

1. Ограниченная функциональность:
--Доступен только один эндпоинт (GET /recipes).
--Отсутствуют POST, PUT, DELETE для полного CRUD.
2. Отсутствие авторизации:
--API публичный, нет защиты (например, API-токена или JWT).
3. Безопасность:
--Пароли базы данных хранятся в коде (db/db.go).
--В будущем будет добавлен .env.
4. Масштабируемость:
--Нет пагинации или фильтрации для GET /recipes.
--При большом количестве рецептов запрос может быть медленным.
5. Документация API:
--Swagger-документация начата, но требует доработки.


### Планы на будущее

## Дорожная карта

Этап 6: Расширение функциональности:
Добавить CRUD-эндпоинты:
POST /recipes (создание рецепта).
PUT /recipes/{id} (обновление рецепта).
DELETE /recipes/{id} (удаление рецепта).
Реализовать пагинацию и фильтрацию (например, GET /recipes?limit=10&offset=0).

Этап 7: Безопасность:
Перенести конфиденциальные данные в .env.
Добавить авторизацию (JWT или API-токены).

Этап 8: Фронтенд:
Разработать простой интерфейс (HTML/JS или React) для управления рецептами.

Этап 9: Деплой:
Настроить деплой на Heroku, AWS или VPS.

Этап 10: Интеграция:
Подключить API к HealthyLifeBot.
Добавить возможность рекомендации рецептов через Telegram.